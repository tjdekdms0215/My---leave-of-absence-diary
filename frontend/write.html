<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìƒˆ ì¼ê¸° ì“°ê¸° - ì„±ë‹¤ì€ì˜ íœ´í•™ì¼ê¸°</title>
    <style>
        body { font-family: 'Arial', sans-serif; background-color: #f4f4f9; padding: 30px; display: flex; justify-content: center; }
        .container { background: white; padding: 40px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 600px; }
        h1 { text-align: center; color: #333; margin-bottom: 30px; }
        
        .form-group { margin-bottom: 20px; }
        label { display: block; font-weight: bold; margin-bottom: 8px; color: #555; }
        input[type="text"], textarea, input[type="file"] { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; font-size: 16px; }
        textarea { resize: vertical; }
        
        .btn-group { display: flex; gap: 10px; margin-top: 30px; }
        button { flex: 1; padding: 15px; border: none; border-radius: 5px; font-size: 16px; font-weight: bold; cursor: pointer; }
        .save-btn { background-color: #4CAF50; color: white; }
        .save-btn:hover { background-color: #45a049; }
        .cancel-btn { background-color: #f44336; color: white; }
        .cancel-btn:hover { background-color: #e53935; }
        
        /* íŒŒì¼ ì²¨ë¶€ ì•ˆë‚´ ë¬¸êµ¬ */
        .file-hint { font-size: 12px; color: #888; margin-top: 5px; display: block; }
    </style>
</head>
<body>

    <div class="container">
        <h1>âœï¸ ìƒˆ íœ´í•™ ì¼ê¸° ì“°ê¸°</h1>
        
        <div class="form-group">
            <label>ë‚ ì§œ (ì˜ˆ: 2026.02)</label>
            <input type="text" id="date" placeholder="ë‚ ì§œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
        </div>
        
        <div class="form-group">
            <label>ì œëª©</label>
            <input type="text" id="title" placeholder="ì¼ê¸° ì œëª©ì„ ì ì–´ì£¼ì„¸ìš”">
        </div>

        <div class="form-group">
            <label>í•œ ì¤„ ìš”ì•½ (ëª©ë¡ì— ë³´ì—¬ìš”!)</label>
            <input type="text" id="desc" placeholder="ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ í•œ ì¤„ë¡œ ìš”ì•½í•œë‹¤ë©´?">
        </div>

        <div class="form-group">
            <label>ìƒì„¸ ë‚´ìš©</label>
            <textarea id="content" rows="8" placeholder="ì˜¤ëŠ˜ ì–´ë–¤ ì¼ì´ ìˆì—ˆë‚˜ìš”? ìì„¸í•œ ì´ì•¼ê¸°ë¥¼ ë“¤ë ¤ì£¼ì„¸ìš”!"></textarea>
        </div>

        <div class="form-group">
            <label>ğŸ“· ì‚¬ì§„ / ë™ì˜ìƒ ì²¨ë¶€ (ì„ íƒ)</label>
            <input type="file" id="media" accept="image/*, video/*">
            <span class="file-hint">ì‚¬ì§„(jpg, png ë“±)ì´ë‚˜ ë™ì˜ìƒ(mp4) íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</span>
        </div>

        <div class="btn-group">
            <button class="save-btn" onclick="savePost()">ì €ì¥í•˜ê¸°</button>
            <button class="cancel-btn" onclick="window.location.href='index.html'">ì·¨ì†Œ</button>
        </div>
    </div>

    <script>
        async function savePost() {
            // 1. ì…ë ¥ëœ ê°’ê³¼ ì²¨ë¶€ëœ íŒŒì¼ ê°€ì ¸ì˜¤ê¸°
            const date = document.getElementById('date').value;
            const title = document.getElementById('title').value;
            const desc = document.getElementById('desc').value;
            const content = document.getElementById('content').value;
            const mediaFile = document.getElementById('media').files[0]; // íŒŒì¼ ë¥ì„!

            // í•„ìˆ˜ í•­ëª© ê²€ì‚¬
            if (!date || !title || !desc) {
                alert("ë‚ ì§œ, ì œëª©, í•œ ì¤„ ìš”ì•½ì€ ê¼­ ì ì–´ì£¼ì„¸ìš”!");
                return;
            }

            // ğŸŒŸ 2. FormData (ê°€ìƒì˜ íƒë°° ìƒì) ë§Œë“¤ì–´ì„œ ë‚´ìš©ë¬¼ ì°¨ê³¡ì°¨ê³¡ ë‹´ê¸°
            const formData = new FormData();
            formData.append('date', date);
            formData.append('title', title);
            formData.append('desc', desc);
            formData.append('content', content);
            
            // íŒŒì¼ì´ ìˆìœ¼ë©´ íƒë°° ìƒìì— 'media'ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ë„£ê¸°
            if (mediaFile) {
                formData.append('media', mediaFile);
            }

            // ë‚´ ì…ì¥ê¶Œ(í† í°) ì±™ê¸°ê¸°
            const token = localStorage.getItem('token');

            try {
                // ì €ì¥ ì¤‘ì„ì„ ì•Œë¦¬ëŠ” ì•Œë¦¼ (íŒŒì¼ ìš©ëŸ‰ì´ í¬ë©´ ì‹œê°„ì´ ì¡°ê¸ˆ ê±¸ë¦´ ìˆ˜ ìˆì–´ìš”!)
                const saveBtn = document.querySelector('.save-btn');
                saveBtn.innerText = "ì €ì¥ ì¤‘... â³";
                saveBtn.disabled = true;

                // ğŸŒŸ ë‹¤ì€ë‹˜ì˜ ì§„ì§œ ë Œë” ë°±ì—”ë“œ ì£¼ì†Œë¡œ ë³´ë‚´ê¸°!
                const response = await fetch('https://my-leave-of-absence-diary.onrender.com/api/timeline', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}` 
                        // ğŸ’¡ ì¤‘ìš”: FormDataë¥¼ ë³´ë‚¼ ë•ŒëŠ” 'Content-Type'ì„ ì•ˆ ì ëŠ” ê²Œ êµ­ë£°ì…ë‹ˆë‹¤! ë¸Œë¼ìš°ì €ê°€ ì•Œì•„ì„œ ì„¸íŒ…í•´ì¤˜ìš”.
                    },
                    body: formData // ì¡°ë¦½í•œ íƒë°° ìƒìë¥¼ í†µì§¸ë¡œ ì „ì†¡!
                });

                if (response.ok) {
                    alert("ì¼ê¸°ì™€ íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰");
                    window.location.href = 'index.html'; // ì €ì¥ ì„±ê³µí•˜ë©´ ë©”ì¸ í™”ë©´ìœ¼ë¡œ!
                } else {
                    const errorData = await response.json();
                    alert("ì €ì¥ ì‹¤íŒ¨: " + (errorData.message || "ì„œë²„ ì˜¤ë¥˜"));
                }
            } catch (error) {
                console.error("ì €ì¥ ì—ëŸ¬:", error);
                alert("ì„œë²„ì™€ ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            } finally {
                // ë²„íŠ¼ ìƒíƒœ ì›ë˜ëŒ€ë¡œ ë³µêµ¬
                const saveBtn = document.querySelector('.save-btn');
                saveBtn.innerText = "ì €ì¥í•˜ê¸°";
                saveBtn.disabled = false;
            }
        }
    </script>

</body>
</html>