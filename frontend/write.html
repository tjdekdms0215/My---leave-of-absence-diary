<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìƒˆ ì¼ê¸° ì“°ê¸° - ì„±ë‹¤ì€ì˜ íœ´í•™ì¼ê¸°</title>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <style>
        body { font-family: 'Arial', sans-serif; background-color: #f4f4f9; padding: 30px; display: flex; justify-content: center; }
        .container { background: white; padding: 40px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 600px; }
        h1 { text-align: center; color: #333; margin-bottom: 30px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; font-weight: bold; margin-bottom: 8px; color: #555; }
        input[type="text"], textarea, input[type="file"] { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; font-size: 16px; }
        textarea { resize: vertical; }
        /* ğŸŒŸ ì—ë””í„° ë†’ì´ ì„¤ì • ì¶”ê°€ */
        #editor-container {
            height: 400px;
            font-size: 16px;
        }
        .btn-group { display: flex; gap: 10px; margin-top: 30px; }
        button { flex: 1; padding: 15px; border: none; border-radius: 5px; font-size: 16px; font-weight: bold; cursor: pointer; }
        .save-btn { background-color: #4CAF50; color: white; }
        .save-btn:hover { background-color: #45a049; }
        .cancel-btn { background-color: #f44336; color: white; }
        .cancel-btn:hover { background-color: #e53935; }
        .file-hint { font-size: 12px; color: #888; margin-top: 5px; display: block; }
    </style>
</head>
<body>

    <div class="container">
        <h1>âœï¸ ìƒˆ íœ´í•™ ì¼ê¸° ì“°ê¸°</h1>
        
        <div class="form-group">
            <label>ë‚ ì§œ (ì˜ˆ: 2026.02)</label>
            <input type="text" id="date" placeholder="ë‚ ì§œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
        </div>
        
        <div class="form-group">
            <label>ì œëª©</label>
            <input type="text" id="title" placeholder="ì¼ê¸° ì œëª©ì„ ì ì–´ì£¼ì„¸ìš”">
        </div>

        <div class="form-group">
            <label>í•œ ì¤„ ìš”ì•½ (ëª©ë¡ì— ë³´ì—¬ìš”!)</label>
            <input type="text" id="desc" placeholder="ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ í•œ ì¤„ë¡œ ìš”ì•½í•œë‹¤ë©´?">
        </div>

        <div class="form-group">
            <label>ìƒì„¸ ë‚´ìš©</label>
            <div class="form-group">
            <label>ìƒì„¸ ë‚´ìš© (ì´ì œ ê¸€ì ê¾¸ë¯¸ê¸°ì™€ ì¤‘ê°„ ì´ë¯¸ì§€ ì‚½ì…ì´ ê°€ëŠ¥í•´ìš”!)</label>
            <div id="editor-container"></div>
        </div>
        </div>

        <div class="form-group">
            <label>ğŸ“· ì‚¬ì§„ / ë™ì˜ìƒ ì²¨ë¶€ (ì—¬ëŸ¬ ì¥ ê°€ëŠ¥!)</label>
            <input type="file" id="media" accept="image/*, video/*" multiple>
            <span class="file-hint">ì‚¬ì§„ì´ë‚˜ ë™ì˜ìƒ íŒŒì¼ì„ ì—¬ëŸ¬ ê°œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ìµœëŒ€ 10ê°œ). ë§¥(Mac)ì—ì„œëŠ” Command(âŒ˜) í‚¤ë¥¼ ëˆ„ë¥´ê³  í´ë¦­í•˜ì„¸ìš”!</span>
        </div>

        <div class="btn-group">
            <button class="save-btn" onclick="savePost()">ì €ì¥í•˜ê¸°</button>
            <button class="cancel-btn" onclick="window.location.href='index.html'">ì·¨ì†Œ</button>
        </div>
    </div>

    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <script>
        // 1. Quill ì—ë””í„° ì„¤ì • ë° ì‹¤í–‰
        var quill = new Quill('#editor-container', {
            theme: 'snow', // 'snow'ëŠ” ê°€ì¥ ê¹”ë”í•œ ê¸°ë³¸ í…Œë§ˆì…ë‹ˆë‹¤.
            placeholder: 'ì˜¤ëŠ˜ ì–´ë–¤ ì¼ì´ ìˆì—ˆë‚˜ìš”? ìì„¸í•œ ì´ì•¼ê¸°ë¥¼ ë“¤ë ¤ì£¼ì„¸ìš”!',
            modules: {
                toolbar: [
                    [{ 'header': [1, 2, false] }], // ì œëª© í¬ê¸° ì¡°ì ˆ
                    ['bold', 'italic', 'underline', 'strike'], // êµµê²Œ, ê¸°ìš¸ì„, ë°‘ì¤„, ì·¨ì†Œì„ 
                    ['blockquote', 'code-block'], // ì¸ìš©êµ¬, ì½”ë“œë¸”ëŸ­
                    [{ 'list': 'ordered'}, { 'list': 'bullet' }], // ìˆ«ì ë¦¬ìŠ¤íŠ¸, ì  ë¦¬ìŠ¤íŠ¸
                    [{ 'color': [] }, { 'background': [] }], // ê¸€ììƒ‰, ë°°ê²½ìƒ‰
                    ['link', 'image', 'video'], // ë§í¬, ì´ë¯¸ì§€, ë™ì˜ìƒ ë²„íŠ¼ (ì•„ì§ ì´ë¯¸ì§€ëŠ” ì œëŒ€ë¡œ ì•ˆ ë¨!)
                    ['clean'] // ì„œì‹ ì§€ìš°ê¸°
                ]
            }
        });
        
        async function savePost() {
            const date = document.getElementById('date').value;
            const title = document.getElementById('title').value;
            const desc = document.getElementById('desc').value;
            const content = document.getElementById('content').value;
            
            // ğŸŒŸ ë³€ê²½ì  2: íŒŒì¼ 'í•œ ê°œ(files[0])'ê°€ ì•„ë‹ˆë¼ 'ì „ì²´ ë¬¶ìŒ(files)'ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
            const mediaFiles = document.getElementById('media').files; 

            if (!date || !title || !desc) {
                alert("ë‚ ì§œ, ì œëª©, í•œ ì¤„ ìš”ì•½ì€ ê¼­ ì ì–´ì£¼ì„¸ìš”!");
                return;
            }

            const formData = new FormData();
            formData.append('date', date);
            formData.append('title', title);
            formData.append('desc', desc);
            formData.append('content', content);
            
            // ğŸŒŸ ë³€ê²½ì  3: ì„ íƒí•œ íŒŒì¼ ê°œìˆ˜ë§Œí¼ ë°˜ë³µí•´ì„œ íƒë°° ìƒìì— ì°¨ê³¡ì°¨ê³¡ ë‹´ìŠµë‹ˆë‹¤!
            for (let i = 0; i < mediaFiles.length; i++) {
                formData.append('media', mediaFiles[i]);
            }

            const token = localStorage.getItem('token');

            try {
                const saveBtn = document.querySelector('.save-btn');
                saveBtn.innerText = "ì €ì¥ ì¤‘... (ì‚¬ì§„ì´ ë§ìœ¼ë©´ ì˜¤ë˜ ê±¸ë ¤ìš”!) â³";
                saveBtn.disabled = true;

                const response = await fetch('https://my-leave-of-absence-diary.onrender.com/api/timeline', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}` 
                    },
                    body: formData
                });

                if (response.ok) {
                    alert("ì¼ê¸°ì™€ ì‚¬ì§„ë“¤ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰");
                    window.location.href = 'index.html'; 
                } else {
                    const errorData = await response.json();
                    alert("ì €ì¥ ì‹¤íŒ¨: " + (errorData.message || "ì„œë²„ ì˜¤ë¥˜"));
                }
            } catch (error) {
                console.error("ì €ì¥ ì—ëŸ¬:", error);
                alert("ì„œë²„ì™€ ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            } finally {
                const saveBtn = document.querySelector('.save-btn');
                saveBtn.innerText = "ì €ì¥í•˜ê¸°";
                saveBtn.disabled = false;
            }
        }
    </script>

</body>
</html>